<div class="settings-container">
  
  <!-- Header Card -->
  <mat-card class="header-card">
    <mat-card-content>
      <div class="header-content">
        <div class="title-section">
          <h1 class="page-title">{{ 'SETTINGS.TITLE' | translate }}</h1>
          <p class="page-subtitle">{{ 'SETTINGS.COMPANY' | translate }}</p>
        </div>
        <button mat-raised-button 
                color="primary" 
                (click)="onSave()"
                [disabled]="settingsForm.invalid || isLoading">
          <mat-icon>save</mat-icon>
          {{ 'COMMON.SAVE' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <form [formGroup]="settingsForm" class="settings-form">
    
    <!-- Company Information Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>business</mat-icon>
          {{ 'SETTINGS.COMPANY' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        
        <!-- Company Name -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.COMPANY_NAME' | translate }}</mat-label>
          <input matInput 
                 formControlName="companyName"
                 [placeholder]="'SETTINGS.COMPANY_NAME' | translate"
                 required>
          <mat-icon matPrefix>domain</mat-icon>
          <mat-error *ngIf="settingsForm.get('companyName')?.invalid">
            {{ getErrorMessage('companyName') }}
          </mat-error>
        </mat-form-field>

        <!-- Company Address -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.COMPANY_ADDRESS' | translate }}</mat-label>
          <textarea matInput 
                    formControlName="companyAddress"
                    [placeholder]="'SETTINGS.COMPANY_ADDRESS' | translate"
                    rows="2"
                    required></textarea>
          <mat-icon matPrefix>location_on</mat-icon>
          <mat-error *ngIf="settingsForm.get('companyAddress')?.invalid">
            {{ getErrorMessage('companyAddress') }}
          </mat-error>
        </mat-form-field>

        <!-- City/Country -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.CITY_COUNTRY' | translate }}</mat-label>
          <input matInput 
                 formControlName="cityCountry"
                 [placeholder]="'1010 Wien, Ã–sterreich'"
                 required>
          <mat-icon matPrefix>public</mat-icon>
          <mat-error *ngIf="settingsForm.get('cityCountry')?.invalid">
            {{ getErrorMessage('cityCountry') }}
          </mat-error>
        </mat-form-field>

        <!-- VAT Number -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.VAT_NUMBER' | translate }}</mat-label>
          <input matInput 
                 formControlName="vatNumber"
                 [placeholder]="'ATU12345678'"
                 required>
          <mat-icon matPrefix>receipt</mat-icon>
          <mat-error *ngIf="settingsForm.get('vatNumber')?.invalid">
            {{ getErrorMessage('vatNumber') }}
          </mat-error>
        </mat-form-field>

      </mat-card-content>
    </mat-card>

    <!-- Bank Details Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>account_balance</mat-icon>
          {{ 'SETTINGS.BANK_DETAILS' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        
        <!-- Bank Name -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.BANK_NAME' | translate }}</mat-label>
          <input matInput 
                 formControlName="bankName"
                 [placeholder]="'SETTINGS.BANK_NAME' | translate">
          <mat-icon matPrefix>account_balance</mat-icon>
        </mat-form-field>

        <!-- Account Holder -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.ACCOUNT_HOLDER' | translate }}</mat-label>
          <input matInput 
                 formControlName="accountHolder"
                 [placeholder]="'SETTINGS.ACCOUNT_HOLDER' | translate">
          <mat-icon matPrefix>person</mat-icon>
        </mat-form-field>

        <div class="form-row">
          <!-- IBAN -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>IBAN</mat-label>
            <input matInput 
                   formControlName="iban"
                   placeholder="AT00 0000 0000 0000 0000">
            <mat-icon matPrefix>credit_card</mat-icon>
          </mat-form-field>

          <!-- BIC -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>BIC</mat-label>
            <input matInput 
                   formControlName="bic"
                   placeholder="ABCDEFGH">
            <mat-icon matPrefix>tag</mat-icon>
          </mat-form-field>
        </div>

      </mat-card-content>
    </mat-card>

    <!-- Legal Details Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>gavel</mat-icon>
          {{ 'SETTINGS.LEGAL_DETAILS' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        
        <div class="form-row">
          <!-- Legal Form -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>{{ 'SETTINGS.LEGAL_FORM' | translate }}</mat-label>
            <input matInput 
                   formControlName="legalForm"
                   [placeholder]="'GmbH'">
            <mat-icon matPrefix>business_center</mat-icon>
          </mat-form-field>

          <!-- Headquarters -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>{{ 'SETTINGS.HEADQUARTERS' | translate }}</mat-label>
            <input matInput 
                   formControlName="headquarters"
                   [placeholder]="'Wien'">
            <mat-icon matPrefix>location_city</mat-icon>
          </mat-form-field>
        </div>

        <div class="form-row">
          <!-- Court Registry -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>{{ 'SETTINGS.COURT_REGISTRY' | translate }}</mat-label>
            <input matInput 
                   formControlName="courtRegistry"
                   [placeholder]="'Handelsgericht Wien'">
            <mat-icon matPrefix>account_balance</mat-icon>
          </mat-form-field>

          <!-- Registration Number -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>{{ 'SETTINGS.REGISTRATION_NUMBER' | translate }}</mat-label>
            <input matInput 
                   formControlName="registrationNumber"
                   [placeholder]="'FN 123456a'">
            <mat-icon matPrefix>confirmation_number</mat-icon>
          </mat-form-field>
        </div>

      </mat-card-content>
    </mat-card>

    <!-- Invoice Settings Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>description</mat-icon>
          {{ 'SETTINGS.INVOICE_SETTINGS' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        
        <!-- Invoice Footer Text -->
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>{{ 'SETTINGS.INVOICE_FOOTER_TEXT' | translate }}</mat-label>
          <textarea matInput 
                    formControlName="invoiceFooterText"
                    [placeholder]="'SETTINGS.INVOICE_FOOTER_PLACEHOLDER' | translate"
                    rows="4"></textarea>
          <mat-icon matPrefix>notes</mat-icon>
          <mat-hint>{{ 'SETTINGS.INVOICE_FOOTER_HINT' | translate }}</mat-hint>
        </mat-form-field>

      </mat-card-content>
    </mat-card>

    <!-- Logo Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>image</mat-icon>
          {{ 'SETTINGS.LOGO' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        
        <div class="logo-section">
          
          <!-- Logo Preview -->
          <div class="logo-preview" *ngIf="hasLogo()">
            <img [src]="getLogoPreview()" 
                 alt="Company Logo"
                 class="logo-image">
            <div class="logo-path">
              <mat-icon>insert_drive_file</mat-icon>
              <span>{{ currentLogoPath }}</span>
            </div>
          </div>

          <!-- No Logo State -->
          <div class="no-logo" *ngIf="!hasLogo()">
            <mat-icon class="no-logo-icon">hide_image</mat-icon>
            <p>{{ 'SETTINGS.LOGO' | translate }}</p>
          </div>

          <!-- Logo Actions -->
          <div class="logo-actions">
            <button mat-raised-button 
                    type="button"
                    (click)="onSelectLogo()">
              <mat-icon>upload_file</mat-icon>
              {{ 'SETTINGS.LOGO_SELECT' | translate }}
            </button>
            
            <button mat-stroked-button 
                    type="button"
                    color="warn"
                    (click)="onRemoveLogo()"
                    *ngIf="hasLogo()">
              <mat-icon>delete</mat-icon>
              {{ 'SETTINGS.LOGO_REMOVE' | translate }}
            </button>
          </div>

        </div>

      </mat-card-content>
    </mat-card>

    <!-- App Settings Card -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>settings</mat-icon>
          {{ 'SETTINGS.APP_SETTINGS' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        
        <div class="form-row">
          
          <!-- Default VAT -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>{{ 'SETTINGS.DEFAULT_VAT' | translate }}</mat-label>
            <mat-select formControlName="defaultVatPercentage" required>
              <mat-option *ngFor="let option of vatOptions" [value]="option.value">
                {{ option.label | translate }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>percent</mat-icon>
            <mat-hint>{{ 'SETTINGS.DEFAULT_VAT' | translate }}</mat-hint>
          </mat-form-field>

          <!-- Language -->
          <mat-form-field appearance="outline" class="form-field-half">
            <mat-label>{{ 'SETTINGS.LANGUAGE' | translate }}</mat-label>
            <mat-select formControlName="language" 
                        (selectionChange)="onLanguageChange($event.value)"
                        required>
              <mat-option *ngFor="let lang of languageOptions" [value]="lang.value">
                <span class="language-option">
                  <span class="flag">{{ lang.flag }}</span>
                  <span>{{ lang.label }}</span>
                </span>
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>language</mat-icon>
            <mat-hint>{{ 'APP.LANGUAGE' | translate }}</mat-hint>
          </mat-form-field>

        </div>

      </mat-card-content>
    </mat-card>

    <!-- Save Button (Bottom) -->
    <div class="action-buttons">
      <button mat-raised-button 
              color="primary" 
              type="button"
              (click)="onSave()"
              [disabled]="settingsForm.invalid || isLoading">
        <mat-icon>save</mat-icon>
        {{ 'COMMON.SAVE' | translate }}
      </button>
    </div>

  </form>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner></mat-spinner>
  </div>

</div>